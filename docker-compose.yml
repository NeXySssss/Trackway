name: trackway

services:
  trackway:
    build: .
    image: "${TRACKWAY_IMAGE:-trackway:latest}"
    container_name: trackway
    restart: unless-stopped
    read_only: true
    tmpfs:
      - /tmp
    environment:
      CONFIG_PATH: /app/config.json
      STORAGE_DRIVER: "${STORAGE_DRIVER:-sqlite}"
      SQLITE_PATH: "${SQLITE_PATH:-/data/trackway.db}"
      SQLITE_RETENTION_DAYS: "${SQLITE_RETENTION_DAYS:-5}"
      SQLITE_BUSY_TIMEOUT_MS: "${SQLITE_BUSY_TIMEOUT_MS:-5000}"
      SQLITE_MAX_OPEN_CONNS: "${SQLITE_MAX_OPEN_CONNS:-1}"
      SQLITE_MAX_IDLE_CONNS: "${SQLITE_MAX_IDLE_CONNS:-1}"
      TRACKWAY_CONFIG_JSON: "${TRACKWAY_CONFIG_JSON:-}"
      TRACKWAY_CONFIG_JSON_B64: "${TRACKWAY_CONFIG_JSON_B64:-}"
    ports:
      - "${TRACKWAY_BIND_IP:-127.0.0.1}:${TRACKWAY_BIND_PORT:-8083}:8080"
    volumes:
      - "${TRACKWAY_CONFIG_PATH:-./config.json}:/app/config.json:ro"
      - trackway-data:/data
    networks:
      - trackway-net

volumes:
  trackway-data:
    name: trackway-data

networks:
  trackway-net:
    name: trackway-net
